<!DOCTYPE html>
<html>
<head>
  <title> DistributedTrain </title>
  <link rel='icon' href="favicon.ico" type="image/x-icon">
  <!-- 引入 marked.js 和 DOMPurify（安全过滤） -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
  <!-- 引入 highlight.js 代码高亮 -->
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/github.min.css">
  <!-- GitHub Markdown CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">
  <style>
    /* GitHub风格样式 */
    .markdown-body {
      box-sizing: border-box;
      min-width: 200px;
      max-width: 980px;
      margin: 0 auto;
      padding: 45px;
    }
    
    @media (max-width: 767px) {
      .markdown-body {
        padding: 15px;
      }
    }
    
    /* 自定义调整 */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
      line-height: 1.5;
      color: #24292e;
      background-color: #fff;
    }
    
    pre {
      border-radius: 6px;
      padding: 16px;
      overflow: auto;
      background-color: #f6f8fa;
    }
    
    code {
      font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
      font-size: 85%;
    }
    
    .hljs {
      background: transparent !important;
    }
  </style>
</head>
<body>
  <div class="markdown-body" id="markdown-container"></div>

  <script>
    // 配置marked
    marked.setOptions({
      highlight: function(code, lang) {
        const language = hljs.getLanguage(lang) ? lang : 'plaintext';
        return hljs.highlight(code, { language }).value;
      },
      langPrefix: 'hljs language-', // highlight.js css expects a top-level 'hljs' class
      breaks: true,
      gfm: true,
      pedantic: false,
      smartLists: true,
      smartypants: false,
      xhtml: false
    });

    // 1. 从服务器加载 Markdown 文件
    fetch('DistributedTrain.md')  // 替换为您的实际文件路径
      .then(response => {
        if (!response.ok) throw new Error("文件加载失败");
        return response.text();
      })
      .then(markdownText => {
        // 2. 解析 Markdown 并安全渲染
        const html = marked.parse(markdownText);
        const cleanHtml = DOMPurify.sanitize(html);
        document.getElementById('markdown-container').innerHTML = cleanHtml;
        
        // 3. 对所有代码块应用高亮
        document.querySelectorAll('pre code').forEach((block) => {
          hljs.highlightElement(block);
        });
      })
      .catch(err => {
        console.error("错误:", err);
        document.getElementById('markdown-container').innerHTML = 
          `<div class="flash flash-error">加载失败: ${err.message}</div>`;
      });
  </script>
</body>
</html>